{% extends "base.html" %}

{% block core %}
<div class="core_title">
  <h1>Configure Model Solutions</h1>
</div>

<p>The following model solutions need configuration. Please set the expected score ranges for each solution.</p>

<form action="{{ url("task", task.id, "model_solutions", "configure") }}" method="POST">
  {{ xsrf_form_html|safe }}

  <table class="bordered" style="margin: 20px 0;">
    <thead>
      <tr>
        <th>Name</th>
        <th>Language</th>
        <th>Description</th>
        <th>Expected Score Min</th>
        <th>Expected Score Max</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
{% for sol in model_solutions %}
      <tr{% if sol.needs_config %} style="background-color: #fff3cd;"{% endif %}>
        <td>
          <strong>{{ sol.name }}</strong>
          <input type="hidden" name="sol_{{ sol.id }}_id" value="{{ sol.id }}" />
        </td>
        <td>{{ sol.language or 'auto-detect' }}</td>
        <td>
          <input type="text" name="sol_{{ sol.id }}_description" value="{{ sol.description }}" placeholder="Optional description" style="width: 200px;" />
        </td>
        <td>
          <input type="number" step="0.01" name="sol_{{ sol.id }}_score_min" value="{{ sol.expected_score_min }}" style="width: 80px;" />
        </td>
        <td>
          <input type="number" step="0.01" name="sol_{{ sol.id }}_score_max" value="{{ sol.expected_score_max }}" style="width: 80px;" />
        </td>
        <td style="color: {% if sol.needs_config %}orange{% else %}green{% endif %};">
          {% if sol.needs_config %}Needs Config{% else %}Configured{% endif %}
        </td>
      </tr>
{% endfor %}
    </tbody>
  </table>

{% if subtasks %}
  <h2>Subtask Expected Scores</h2>
  <p>Configure expected scores per subtask:</p>
  
  <table class="bordered" style="margin: 20px 0;">
    <thead>
      <tr>
        <th>Solution</th>
{% for st in subtasks if st.max_score > 0 %}
        <th colspan="2">{{ st.display_name }} (max {{ st.max_score }})</th>
{% endfor %}
      </tr>
      <tr>
        <th></th>
{% for st in subtasks if st.max_score > 0 %}
        <th>Min</th>
        <th>Max</th>
{% endfor %}
      </tr>
    </thead>
    <tbody>
{% for sol in model_solutions %}
      <tr{% if sol.needs_config %} style="background-color: #fff3cd;"{% endif %}>
        <td><strong>{{ sol.name }}</strong></td>
{% for st in subtasks if st.max_score > 0 %}
        <td>
          <input type="number" step="0.01" name="sol_{{ sol.id }}_st_{{ st.idx }}_min" 
                 value="{% if sol.subtask_expected_scores and sol.subtask_expected_scores[st.idx|string] %}{{ sol.subtask_expected_scores[st.idx|string].min }}{% else %}0{% endif %}" 
                 style="width: 60px;" />
        </td>
        <td>
          <input type="number" step="0.01" name="sol_{{ sol.id }}_st_{{ st.idx }}_max" 
                 value="{% if sol.subtask_expected_scores and sol.subtask_expected_scores[st.idx|string] %}{{ sol.subtask_expected_scores[st.idx|string].max }}{% else %}{{ st.max_score }}{% endif %}" 
                 style="width: 60px;" />
        </td>
{% endfor %}
      </tr>
{% endfor %}
    </tbody>
  </table>
{% endif %}

  <div style="margin: 20px 0;">
    <input type="submit" value="Save Configuration">
    <input type="button" value="Skip" onclick="window.location.href='{{ url("task", task.id) }}'">
  </div>
</form>

<div style="margin-top: 20px; padding: 10px; background-color: #e7f3ff; border: 1px solid #b6d4fe;">
  <strong>Note:</strong> Solutions highlighted in yellow have default values and may need configuration.
  You can also configure them later from the task page.
</div>

{% endblock core %}
