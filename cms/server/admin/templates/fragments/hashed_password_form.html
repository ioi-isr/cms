{# This snippet shows a form to edit a hashed password for users and participations. #}

{% if hashed_password is not none %}
  {% set method, password = parse_authentication(hashed_password) %}
{% else %}
  {% set method = "plaintext" %}
  {% set password = "" %}
{% endif %}

<input type="text" name="password" id="password-field" value="{{ password if method == "plaintext" else "" }}" />
<select name="method">
  <option value="plaintext" {{ "selected" if method == "plaintext" else "" }}>Plain text</option>
  <option value="bcrypt" {{ "selected" if method == "bcrypt" else "" }}>Hashed (bcrypt)</option>
</select>
<div id="password-strength-container" style="margin-top: 5px;">
  <div id="password-strength-bar" style="height: 5px; border-radius: 3px; transition: all 0.3s ease; display: none;"></div>
  <span id="password-strength-text" style="font-size: 12px;"></span>
</div>
<script>
(function() {
  var strengthMessages = ["Very weak", "Weak", "Fair", "Strong", "Very strong"];
  var strengthColors = ["#dc3545", "#dc3545", "#ffc107", "#28a745", "#28a745"];
  var strengthWidths = ["20%", "40%", "60%", "80%", "100%"];

  $("#password-field").on("input", function() {
    var pwd = $(this).val();
    var $bar = $("#password-strength-bar");
    var $text = $("#password-strength-text");

    if (!pwd) {
      $bar.hide();
      $text.text("");
      return;
    }

    if (typeof zxcvbn === "function") {
      var result = zxcvbn(pwd);
      var score = result.score;

      $bar.css({
        "background-color": strengthColors[score],
        "width": strengthWidths[score]
      }).show();
      $text.text("Password strength: " + strengthMessages[score]);
      $text.css("color", strengthColors[score]);
    }
  });
})();
</script>
{% if method != "plaintext" %}
<script>
  $("[name=method]").change(function (e) {
    if (e.target.value != "{{ method }}") {
      $("[name=password]").attr("placeholder", "");
    }
    else {
      $("[name=password]").attr("placeholder", "The password is hashed, type a new one in here to change it");
    }});
  $("[name=method]").change();
</script>
{% endif %}

