{#
  Fragment for user date of birth and picture upload form fields.

  Parameters:
  - user: The user object (optional, for edit mode)
  - max_file_size_mb: Maximum file size in MB (default: 5)
#}
{% set max_file_size_mb = max_file_size_mb|default(5) %}
{% set max_file_size_bytes = max_file_size_mb * 1024 * 1024 %}

<tr>
  <td>
    <span class="info" title="Date of birth of the contestant."></span>
    Date of birth
  </td>
  <td>
    <input type="date" name="date_of_birth" id="date_of_birth_input"
           value="{{ user.date_of_birth.isoformat() if user is defined and user.date_of_birth is not none else '' }}"/>
    <script>
    (function() {
      var input = document.getElementById('date_of_birth_input');
      var today = new Date();
      var maxDate = today.toISOString().split('T')[0];
      var minDate = new Date(today.getFullYear() - 120, today.getMonth(), today.getDate()).toISOString().split('T')[0];
      input.setAttribute('max', maxDate);
      input.setAttribute('min', minDate);
    })();
    </script>
  </td>
</tr>
<tr>
  <td>
    <span class="info" title="Profile picture of the contestant. Max {{ max_file_size_mb }}MB, JPEG/PNG/GIF/WEBP, max 1280x1280 pixels."></span>
    Profile picture
  </td>
  <td>
    {% if user is defined and user.picture %}
    <div id="current_picture_container" style="margin-bottom: 10px;">
      <img src="{{ url('file', user.picture, 'picture') }}" alt="Profile picture" style="max-width: 160px; max-height: 240px; border: 1px solid #ccc;"/>
      <br/>
      <button type="button" onclick="if(confirm('Are you sure you want to remove this picture?')) { CMS.AWSUtils.ajax_post('{{ url('user', user.id, 'remove_picture') }}'); }">Remove picture</button>
    </div>
    {% endif %}
    <input type="file" name="picture" accept="image/jpeg,image/png,image/gif,image/webp" id="picture_input"/>
    <div id="picture_size_error" style="color: red; display: none;">File is too large. Maximum size is {{ max_file_size_mb }}MB.</div>
    <script>
    (function() {
      var pictureInput = document.getElementById('picture_input');
      var sizeError = document.getElementById('picture_size_error');
      var maxSize = {{ max_file_size_bytes }};

      pictureInput.addEventListener('change', function() {
        sizeError.style.display = 'none';
        if (this.files.length > 0 && this.files[0].size > maxSize) {
          sizeError.style.display = 'block';
          this.value = '';
        }
      });
    })();
    </script>
  </td>
</tr>
