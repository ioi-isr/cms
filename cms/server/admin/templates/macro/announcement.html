{% import 'macro/markdown_input.html' as macro_markdown %}
{% macro add_form(contest, next_url=None) %}
  {% if contest is not none and (admin.permission_all or admin.permission_messaging) %}
    <div class="notifications">
      <div class="notification communication">
        <div class="notification_msg">
          <form method="post" action="{{ url("contest", contest.id, "announcements", "add") }}">
            {% if next_url %}<input type="hidden" name="next" value="{{ next_url }}" />{% endif %}
            {{ xsrf_form_html|safe }}
            <div class="notification_subject">
              <label for="new_subject_{{ contest.id }}">Subject</label>
              <input type="text" name="subject" id="new_subject_{{ contest.id }}" style="width: 100%" list="task_names_list_{{ contest.id }}" autocomplete="off">
              <datalist id="task_names_list_{{ contest.id }}">
                {% for task in contest.visible_tasks %}
                <option value="{{ task.name }}">
                {% endfor %}
              </datalist>
            </div>
            <div class="notification_text">
              <label>Text</label>
              {{ macro_markdown.markdown_input("text") }}
            </div>
            <input type="submit" value="Add announcement" />
            {{ macro_markdown.markdown_preview() }}
          </form>
        </div>
      </div>
    </div>
  {% endif %}
{% endmacro %}

{% macro entries(announcements, contest, admin, allow_remove=False) %}
  {% if announcements %}
    {% for msg in announcements %}
    <div class="notification communication">
      <div class="notification_msg">
        {% if allow_remove %}
        <div class="announcement_remove">
          <a onclick="CMS.AWSUtils.ajax_delete('{{ url("contest", contest.id, "announcement", msg.id) }}'); ">Remove</a>
        </div>
        {% endif %}
        <div class="notification_timestamp">{{ msg.timestamp }}</div>
        <div class="notification_subject">{{ msg.subject }}</div>
        <div class="notification_text">{{ msg.text | markdown }}</div>
        <hr>
        <div class="notification_admin_owner">
          By: {{ msg.admin.name if msg.admin is not none else "<unknown>" }}
        </div>
      </div>
    </div>
    {% endfor %}
  {% else %}
    <p>No announcements.</p>
  {% endif %}
{% endmacro %}

{% macro listing(announcements, contest, admin, allow_remove=False) %}
  {% if announcements %}
    <div class="notifications">
      {{ entries(announcements, contest, admin, allow_remove) }}
    </div>
  {% else %}
    <p>No announcements.</p>
  {% endif %}
{% endmacro %}
