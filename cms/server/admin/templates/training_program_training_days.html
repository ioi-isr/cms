{% extends "base.html" %}

{% block js_init %}
{% for td in training_program.training_days %}
CMS.AWSUtils.initTagify({
    inputSelector: 'input[name="training_day_types_{{ td.id }}"]',
    whitelist: {{ all_training_day_types | tojson }},
    getSaveUrl: function() {
        return '{{ url("training_program", training_program.id, "training_day", td.id, "types") }}';
    },
    saveParamName: 'training_day_types',
    placeholder: 'Type tags',
    editable: true,
    pattern: /^[^,]+$/,
    invalidMessage: 'Types cannot contain commas.'
});
{% endfor %}
{% endblock js_init %}

{% block core %}
<div class="core_title">
  <h1>Training Days of <a href="{{ url("training_program", training_program.id) }}">{{ training_program.name }}</a></h1>
</div>

<p>
  <a href="{{ url("training_program", training_program.id, "training_days", "add") }}">Add a new training day</a>
</p>

<h2>Active Training Days</h2>

<form action="{{ url("training_program", training_program.id, "training_days") }}" method="POST">
  {{ xsrf_form_html|safe }}
  Remove selected training day:
  <input type="submit" name="operation"
{% if not admin.permission_all %}
         disabled
{% endif %}
         value="Remove" />

  <br>

  Move selected training day:
  <input type="submit" name="operation"
{% if not admin.permission_all %}
         disabled
{% endif %}
         value="up by 1" />
  <input type="submit" name="operation"
{% if not admin.permission_all %}
         disabled
{% endif %}
         value="down by 1" />

  <table class="bordered" id="training_days_table">
    <thead>
      <tr>
        <th></th>
        <th>Name</th>
        <th>Description</th>
        <th>Types</th>
        <th>Start</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% set active_training_days = training_program.training_days | selectattr("contest") | list %}
      {% for td in active_training_days %}
      <tr>
        <td>
          <input type="radio" name="training_day_id" value="{{ td.id }}"/>
        </td>
        <td><a href="{{ url("contest", td.contest.id) }}">{{ td.contest.name }}</a></td>
        <td>{{ td.contest.description }}</td>
        <td style="min-width: 200px;">
          <input type="text" name="training_day_types_{{ td.id }}" value="{{ td.training_day_types|join(', ') }}"/>
        </td>
        <td>
          {% if td.contest.start.year <= training_program.managing_contest.stop.year %}
            {{ td.contest.start.strftime("%Y-%m-%d %H:%M") }}
          {% else %}
            -
          {% endif %}
        </td>
        <td>
          <a href="{{ url("training_program", training_program.id, "training_day", td.id, "archive") }}">Archive</a>
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="6">(no active training days)</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <script>
    $(document).ready(function() {
      CMS.AWSUtils.init_table_sort($("#training_days_table"), false, 3, false);
    });
  </script>
</form>

<h2>Archived Training Days</h2>

<table class="bordered" id="archived_training_days_table">
  <thead>
    <tr>
      <th>Name</th>
      <th>Description</th>
      <th>Types</th>
      <th>Start</th>
    </tr>
  </thead>
  <tbody>
    {% set archived_training_days = training_program.training_days | rejectattr("contest") | list %}
    {% for td in archived_training_days %}
    <tr>
      <td>{{ td.name or "(no name)" }}</td>
      <td>{{ td.description or "(no description)" }}</td>
      <td style="min-width: 200px;">
        <input type="text" name="training_day_types_{{ td.id }}" value="{{ td.training_day_types|join(', ') }}"/>
      </td>
      <td>
        {% if td.start_time %}
          {{ td.start_time.strftime("%Y-%m-%d %H:%M") }}
        {% else %}
          -
        {% endif %}
      </td>
    </tr>
    {% else %}
    <tr>
      <td colspan="4">(no archived training days)</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<script>
  $(document).ready(function() {
    CMS.AWSUtils.init_table_sort($("#archived_training_days_table"), false, 2, false);
  });
</script>
{% endblock core %}
